<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>账号管理 电数宝 </title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
<link href="__PJ__/home/css/bootstrap.min.css" rel="stylesheet">
<link href="__PJ__/home/css/cropper.min.css" rel="stylesheet">
<link href="__PJ__/home/css/100ec_style.css" rel="stylesheet">
<link href="__PJ__/home/css/member.css" rel="stylesheet">
    <script src="__PJ__/home/js/jquery.min.js"></script>
<style>
</style>
</head>

<body>
   <!-- 头像上传模态框 -->
<div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form class="avatar-form" action="" id="" name="" method="post">
                <div class="modal-header">
                    <button class="close" data-dismiss="modal" type="button">&times;</button>
                    <h4 class="modal-title" id="avatar-modal-label">上传头像</h4>
                </div>
                <div class="modal-body">
                    <div class="avatar-body">
                        <div class="avatar-upload">
                            <input class="avatar-src" name="avatar_src" type="hidden">
                            <input class="avatar-data" name="avatar_data" type="hidden">
                            <label for="avatarInput" style="line-height: 35px;">图片上传</label>
                            <button class="btn btn3"  type="button" style="height: 35px;" onClick="$('input[id=avatarInput]').click();">请选择图片</button>
                            <span id="avatar-name"></span>
                            <input class="avatar-input hide" id="avatarInput" name="avatar_file" type="file"></div>
                        <div class="row">
                            <div class="col-md-9">
                                <div class="avatar-wrapper"></div>
                            </div>
                            <div class="col-md-3">
                                <div class="avatar-preview preview-lg" id="imageHead"></div>
                                <!--<div class="avatar-preview preview-md"></div>
                        <div class="avatar-preview preview-sm"></div>-->
                            </div>
                        </div>
                        <div class="row avatar-btns">
                            <div class="col-md-4">
                                <div class="btn-group">
                                    <button class="btn btn3 fa fa-undo" data-method="rotate" data-option="-90" type="button" title="Rotate -90 degrees"> 向左旋转</button>
                                </div>
                                <div class="btn-group">
                                    <button class="btn  btn3 fa fa-repeat" data-method="rotate" data-option="90" type="button" title="Rotate 90 degrees"> 向右旋转</button>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn3 btn-block avatar-save fa fa-save" type="button" data-dismiss="modal"> 保存修改</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<include file="Public/dsb-header"/>
<include file="Public/usernav"/>




<div class="member-info member-box" style="min-height: 0px;">
    <h4 class="m-title"><i class="glyphicon glyphicon-file"></i>头像修改</h4>
    <div data-toggle="modal" data-target="#avatar-modal" class="btn"><p>点击修改头像</p></div>
</div>



<div class="member-info member-box mb" style="margin-top: 10px">
    <h4 class="m-title"><i class="glyphicon glyphicon-list"></i>账号信息</h4>
    <div class="member_right_main2">
        <form class="form-horizontal" action="{:U('memberupdate')}" id="wanshan_form"  method="post">
        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">账号</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="username" name="username" placeholder="{$member['username']}" readonly>
          </div>
        </div>

        <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">昵称</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="name" name="name" value="{$member['name']}">
          </div>
        </div>

         <div class="form-group">
          <label for="inputPassword3" class="col-sm-2 control-label">性别</label>
          <div class="col-sm-10">
            <label class="radio-inline">
                <input type="radio" name="sex" id="sex" value="男" <if condition="$member['sex'] eq '男' "> checked="checked"</if>> 男
              </label>
              <label class="radio-inline">
                <input type="radio" name="sex" id="sex" value="女" <if condition="$member['sex'] eq '女' "> checked="checked"</if>> 女
              </label>
          </div>
        </div>

        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">邮箱</label>
          <div class="col-sm-10">
            <input type="email" class="form-control" id="email" name="email" value="{$member['email']}">
          </div>
        </div>

        <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">微信</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="weixin" name="weixin" value="{$member['weixin']}">
          </div>
        </div>

         <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">公司名称</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="company" name="company" value="{$member['company']}">
          </div>
        </div>

         <div class="form-group">
          <label for="inputEmail3" class="col-sm-2 control-label">职位/称号</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="zw" name="zw" value="{$member['zw']}">
          </div>
        </div>

        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-default">确认保存</button>
          </div>
        </div>


        </form>
    </div>
</div>



<include file="Public/userfooter"/>




<script src="__PJ__/home/js/jquery.min.js"></script>
<script src="__PJ__/home/js/bootstrap.min.js"></script>
<script src="__PJ__/home/js/html2canvas.js"></script>
<script src="__PJ__/home/js/user/user.js"></script>
<script src="__PJ__/home/js/user/cropper.js"></script>
<script src="__PJ__/home/js/user/sitelogo.js"></script>
<script>

//做个下简易的验证  大小 格式 
    $('#avatarInput').on('change', function(e) {
        var filemaxsize = 1024 * 5;//5M
        var target = $(e.target);
        var Size = target[0].files[0].size / 1024;
        if(Size > filemaxsize) {
            alert('图片过大，请重新选择!');
            $(".avatar-wrapper").childre().remove;
            return false;
        }
        if(!this.files[0].type.match(/image.*/)) {
            alert('请选择正确的图片!')
        } else {
            var filename = document.querySelector("#avatar-name");
            var texts = document.querySelector("#avatarInput").value;
            var teststr = texts; 
            testend = teststr.match(/[^\\]+\.[^\(]+/i); //直接完整文件名的
            filename.innerHTML = testend;
        }
    
    });

    $(".avatar-save").on("click", function() {
        var img_lg = document.getElementById('imageHead');
        // 截图小的显示框内的内容
        html2canvas(img_lg, {
            allowTaint: true,
            taintTest: false,
            onrendered: function(canvas) {
                canvas.id = "mycanvas";
                //生成base64图片数据
                var dataUrl = canvas.toDataURL("image/jpeg");
                var newImg = document.createElement("img");
                newImg.src = dataUrl;
                imagesAjax(dataUrl)
            }
        });
    })
    
    function imagesAjax(src) {
        var data = {};
        // img=cropper.getDataURL()
        data.img = src;
        // data.jid = $('#jid').val();
       //  $.post("{:U('change_imgupdate')}", data, function(data){
       //     if (data.length>0){ 
       //      alert(data);
       //     } 
       // }) 
        $.ajax({
            url: "{:U('change_imgupdate')}",
            data: data,
            type: "POST",
            success: function(data) {
                alert(data);
                location.reload(true)   
            }
        });
    }
</script>

</body>
</html>